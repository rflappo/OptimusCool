<!doctype html>
<html lang="es" class="h-full">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
        <meta name="theme-color" content="#1e40af" />
        <title>Optimus Cool (Huabon) — Soluciones de Refrigeración</title>
        <meta
            name="description"
            content="Unidades de frío para utilitarios y furgones. Alta eficiencia, bajo mantenimiento y soporte técnico."
        />
        <link rel="icon" href="favicon.png" />
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            brand: {
                                50: "#eef6ff",
                                100: "#dceefe",
                                200: "#bfe0fd",
                                300: "#93caff",
                                400: "#60a5fa",
                                500: "#2f7ef1",
                                600: "#2563eb",
                                700: "#1d4ed8",
                                800: "#1e40af",
                                900: "#1e3a8a",
                            },
                            accent: "#ef4444",
                        },
                    },
                },
            };
        </script>
        <style>
            .pattern {
                background-image: radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.08) 2px, transparent 2px);
                background-size: 32px 32px;
            }
            @media (prefers-reduced-motion: reduce) {
                * {
                    scroll-behavior: auto !important;
                    animation: none !important;
                    transition: none !important;
                }
            }
        </style>
    </head>
    <body class="h-full text-slate-800 antialiased">
        <!-- Safe-area top spacer for iOS -->
        <div style="height: env(safe-area-inset-top)"></div>

        <!-- Top bar -->
        <div class="bg-gradient-to-br from-brand-800 via-brand-700 to-brand-600 text-white text-sm">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 flex items-center justify-between h-5"></div>
        </div>

        <!-- Header / Nav -->
        <header
            class="sticky top-0 z-50 border-b border-slate-100 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70"
        >
            <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8" aria-label="Main">
                <div class="flex h-20 items-center justify-between">
                    <a href="{{ url_for('home') }}" class="flex items-center gap-2">
                        <img
                            src="{{ url_for('static', path='img/logo.png') }}"
                            alt="{{ company_name }}"
                            class="h-14 w-auto"
                        />
                    </a>

                    <!-- Desktop -->
                    <div class="hidden md:flex items-center gap-6">
                        <a class="font-bold text-lg hover:text-brand-700" href="{{ url_for('home') }}">Inicio</a>
                        <a class="font-bold text-lg hover:text-brand-700" href="#">Catálogo</a>
                        <a class="font-bold text-lg hover:text-brand-700" href="{{ url_for('contact') }}">Contacto</a>
                    </div>
                    <a
                        href="{{ url_for('static', path='pdf/OPTIMUS.pdf') }}"
                        class="hidden md:inline-flex items-center rounded-lg bg-accent px-4 py-2 text-white font-medium hover:bg-red-500"
                        >Descargá el catálogo</a
                    >

                    <!-- Mobile toggle -->
                    <button
                        id="menuBtn"
                        class="md:hidden inline-flex h-11 w-11 items-center justify-center rounded-md hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-brand-600"
                        aria-label="Abrir menú"
                        aria-controls="menuPanel"
                        aria-expanded="false"
                    >
                        <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>

                <!-- Mobile panel -->
                <div id="menuPanel" class="md:hidden hidden pb-4 space-y-2" role="dialog">
                    <a href="{{ url_for('home') }}" class="block rounded-lg px-3 py-3 hover:bg-slate-100">Inicio</a>
                    <a href="{{ url_for('catalog') }}" class="block rounded-lg px-3 py-3 hover:bg-slate-100"
                        >Ver Catálogo</a
                    >
                    <a href="{{ url_for('contact') }}" class="block rounded-lg px-3 py-3 hover:bg-slate-100"
                        >Contacto</a
                    >
                    <a
                        href="{{ url_for('static', path='pdf/OPTIMUS.pdf') }}"
                        class="block rounded-lg bg-accent px-3 py-3 text-center text-white"
                        >Descargá el catálogo</a
                    >
                </div>
            </nav>
        </header>

        <!-- Filter Section -->
        <section class="mt-8 sm:mt-12">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="bg-white rounded-xl border border-slate-200 p-6">
                    <h2 class="text-xl font-bold text-slate-800 mb-6">Filtrar unidades de refrigeración</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Tipo de unidad -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Tipo de unidad</label>
                            <select
                                id="unitType"
                                class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500"
                            >
                                <option value="">Todos los tipos</option>
                                <option value="HT">Termo Huabon</option>
                                <option value="T">Montaje en techo</option>
                                <option value="N">Montaje frontal</option>
                                <option value="U">Montaje inferior</option>
                                <option value="M">Monobloque</option>
                                <option value="F">Congelados</option>
                                <option value="S">Modo de espera</option>
                                <option value="E">Eléctrico</option>
                                <option value="C">Cobre</option>
                            </select>
                        </div>
                        <!-- Capacidad mínima -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Capacidad mínima (W)</label>
                            <input
                                type="number"
                                id="minCapacity"
                                placeholder="Ej: 2000"
                                class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500"
                            />
                        </div>

                        <!-- Capacidad máxima -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Capacidad máxima (W)</label>
                            <input
                                type="number"
                                id="maxCapacity"
                                placeholder="Ej: 5000"
                                class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500"
                            />
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3 mt-6">
                        <button
                            id="applyFilters"
                            class="inline-flex items-center rounded-lg bg-brand-600 px-4 py-2 text-white font-medium hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-500"
                        >
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                                ></path>
                            </svg>
                            Aplicar filtros
                        </button>
                        <button
                            id="clearFilters"
                            class="inline-flex items-center rounded-lg bg-accent px-4 py-2 text-white font-medium hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
                        >
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"
                                ></path>
                            </svg>
                            Limpiar filtros
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="mt-8 sm:mt-12">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div id="loadingIndicator" class="hidden text-center py-8">
                    <div class="inline-flex items-center">
                        <svg
                            class="animate-spin -ml-1 mr-3 h-5 w-5 text-brand-600"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                        >
                            <circle
                                class="opacity-25"
                                cx="12"
                                cy="12"
                                r="10"
                                stroke="currentColor"
                                stroke-width="4"
                            ></circle>
                            <path
                                class="opacity-75"
                                fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                            ></path>
                        </svg>
                        Cargando unidades...
                    </div>
                </div>

                <div id="resultsContainer" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-slate-800">
                            <span id="resultsCount">0</span> unidades encontradas
                        </h3>
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-slate-600">Ordenar por:</label>
                            <select
                                id="sortBy"
                                class="rounded-lg border border-slate-300 px-3 py-1 text-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500"
                            >
                                <option value="modelo">Modelo</option>
                                <option value="capacidad">Capacidad</option>
                                <option value="volumen">Volumen recomendado</option>
                            </select>
                        </div>
                    </div>

                    <div id="unitsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Units will be populated here -->
                    </div>
                </div>

                <div id="initialMessage" class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                        ></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-slate-900">Aplique filtros de búsqueda</h3>
                    <p class="mt-1 text-sm text-slate-500">
                        Aplique filtros para buscar entre las más de 20 unidades disponibles.
                    </p>
                </div>

                <div id="noResults" class="hidden text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"
                        ></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-slate-900">No se encontraron unidades</h3>
                    <p class="mt-1 text-sm text-slate-500">Intenta ajustar los filtros para encontrar lo que buscas.</p>
                </div>
            </div>
        </section>

        <!-- CTA -->
        <section class="mt-16 sm:mt-20">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div
                    class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-brand-800 to-brand-600 text-white"
                >
                    <svg
                        class="absolute -right-10 -top-10 h-56 w-56 opacity-20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.2"
                        aria-hidden="true"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18M3 12h18M5 5l14 14M19 5L5 19" />
                    </svg>
                    <div
                        class="relative p-6 md:p-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-4"
                    >
                        <div>
                            <h3 class="text-xl sm:text-2xl font-bold">¿Listo para mejorar tu cadena de frío?</h3>
                            <p class="mt-2 text-brand-100">
                                Integración rápida, soporte cercano y rendimiento comprobado.
                            </p>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <a
                                href="{{ url_for('contact') }}"
                                class="inline-flex min-h-[56px] items-center rounded-lg bg-white px-5 py-3 font-semibold text-brand-800 hover:bg-brand-50"
                                >Contactanos</a
                            >
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-16 sm:mt-20 bg-slate-50 border-t border-slate-200">
            <div
                class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 flex flex-col md:flex-row md:justify-between gap-8"
            >
                <div>
                    <div class="flex items-center gap-2">
                        <img
                            src="{{ url_for('static', path='img/logo.png') }}"
                            alt="{{ company_name }}"
                            class="h-9 w-auto"
                        />
                    </div>
                    <p class="mt-3 text-sm text-slate-600">Soluciones de refrigeración vehicular a medida.</p>
                </div>
                <div>
                    <h3 class="font-semibold">Empresa</h3>
                    <ul class="mt-3 space-y-2 text-sm">
                        <li><a class="hover:text-brand-700" href="{{ url_for('home') }}">Inicio</a></li>
                        <li><a class="hover:text-brand-700" href="#">Catálogo</a></li>
                        <li><a class="hover:text-brand-700" href="{{ url_for('contact') }}">Contacto</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold">Contacto</h3>
                    <ul class="mt-3 space-y-2 text-sm">
                        <li>
                            Email:
                            <a class="hover:text-brand-700" href="mailto:{{ email }}">{{ email }}</a>
                        </li>
                        <li>Tel: <a class="hover:text-brand-700" href="tel:{{ phone }}">{{ phone }}</a></li>
                        <li>
                            WhatsApp: <a class="hover:text-brand-700" href="https://wa.me/{{ phone }}">Escribinos</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-slate-200 py-6 text-center text-sm text-slate-600">
                © {{ year }} {{ company_name }}. Todos los derechos reservados.
            </div>
        </footer>

        <!-- Unit Details Modal -->
        <div
            id="unitModal"
            class="fixed inset-0 z-50 hidden overflow-y-auto"
            aria-labelledby="modal-title"
            role="dialog"
            aria-modal="true"
        >
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <!-- Background overlay -->
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                <!-- Modal panel -->
                <div
                    class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"
                >
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h3 id="modalTitle" class="text-2xl font-bold text-slate-800"></h3>
                                <p id="modalSubtitle" class="text-sm text-slate-600 mt-1"></p>
                            </div>
                            <button
                                id="closeModal"
                                class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-brand-500"
                            >
                                <span class="sr-only">Cerrar</span>
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M6 18L18 6M6 6l12 12"
                                    />
                                </svg>
                            </button>
                        </div>

                        <div id="modalContent" class="space-y-6">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button
                            id="closeModalBtn"
                            type="button"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 sm:ml-3 sm:w-auto sm:text-sm"
                        >
                            Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile menu script (ARIA-friendly) -->
        <script>
            const btn = document.getElementById("menuBtn");
            const panel = document.getElementById("menuPanel");
            if (btn && panel) {
                btn.addEventListener("click", () => {
                    const open = panel.classList.toggle("hidden") === false;
                    btn.setAttribute("aria-expanded", String(open));
                });
            }
        </script>

        <!-- Catalog Filter Script -->
        <script>
            class CatalogFilter {
                constructor() {
                    this.filteredUnits = [];
                    this.hasSearched = false;
                    this.init();
                }

                async init() {
                    this.setupEventListeners();
                    // Don't show any units on initial load
                }

                setupEventListeners() {
                    document.getElementById("applyFilters").addEventListener("click", () => this.applyFilters());
                    document.getElementById("clearFilters").addEventListener("click", () => this.clearFilters());
                    document.getElementById("sortBy").addEventListener("change", () => this.sortUnits());

                    // Modal event listeners
                    document.getElementById("closeModal").addEventListener("click", () => this.closeModal());
                    document.getElementById("closeModalBtn").addEventListener("click", () => this.closeModal());

                    // Close modal when clicking outside
                    document.getElementById("unitModal").addEventListener("click", (e) => {
                        if (e.target.id === "unitModal") {
                            this.closeModal();
                        }
                    });
                }

                async applyFilters() {
                    this.hasSearched = true;
                    const filters = this.getFilterValues();
                    await this.loadFilteredUnits(filters);
                    this.sortUnits();
                    this.displayResults();
                }

                async loadFilteredUnits(filters) {
                    try {
                        const params = new URLSearchParams();
                        if (filters.unitType) params.append("unit_type", filters.unitType);
                        if (filters.minCapacity > 0) params.append("min_capacity", filters.minCapacity);
                        if (filters.maxCapacity < Infinity) params.append("max_capacity", filters.maxCapacity);

                        const response = await fetch(`/api/catalog?${params.toString()}`);
                        this.filteredUnits = await response.json();
                    } catch (error) {
                        console.error("Error loading filtered units:", error);
                        this.showError("Error al cargar las unidades filtradas");
                    }
                }

                getFilterValues() {
                    return {
                        unitType: document.getElementById("unitType").value,
                        minCapacity: parseInt(document.getElementById("minCapacity").value) || 0,
                        maxCapacity: parseInt(document.getElementById("maxCapacity").value) || Infinity,
                    };
                }

                getUnitCapacity(unit) {
                    const datos = unit.Datos || {};
                    const refrigeracion = datos["Capacidad de refrigeración"] || {};
                    const capacidad0a38 = refrigeracion["0a38"] || [];

                    if (capacidad0a38.length > 0) {
                        const watts = capacidad0a38[0];
                        const match = watts.match(/(\d+)W/);
                        return match ? parseInt(match[1]) : 0;
                    }

                    return 0;
                }

                sortUnits() {
                    const sortBy = document.getElementById("sortBy").value;

                    this.filteredUnits.sort((a, b) => {
                        switch (sortBy) {
                            case "modelo":
                                return a.Modelo.localeCompare(b.Modelo);
                            case "capacidad":
                                return this.getUnitCapacity(b) - this.getUnitCapacity(a);
                            case "volumen":
                                const volA = this.getRecommendedVolume(a);
                                const volB = this.getRecommendedVolume(b);
                                return volB - volA;
                            default:
                                return 0;
                        }
                    });

                    this.displayResults();
                }

                getRecommendedVolume(unit) {
                    const datos = unit.Datos || {};
                    const volumen = datos["Tamaño de caja recomendado"] || {};
                    return volumen.max || 0;
                }

                displayResults() {
                    const loadingIndicator = document.getElementById("loadingIndicator");
                    const resultsContainer = document.getElementById("resultsContainer");
                    const noResults = document.getElementById("noResults");
                    const initialMessage = document.getElementById("initialMessage");
                    const resultsCount = document.getElementById("resultsCount");
                    const unitsGrid = document.getElementById("unitsGrid");

                    // Hide all sections first
                    loadingIndicator.classList.add("hidden");
                    resultsContainer.classList.add("hidden");
                    noResults.classList.add("hidden");

                    // Show initial message if no search has been made
                    if (!this.hasSearched) {
                        if (initialMessage) initialMessage.classList.remove("hidden");
                        return;
                    }

                    // Hide initial message if search has been made
                    if (initialMessage) initialMessage.classList.add("hidden");

                    if (this.filteredUnits.length === 0) {
                        noResults.classList.remove("hidden");
                        return;
                    }

                    // Update results count
                    resultsCount.textContent = this.filteredUnits.length;

                    // Generate unit cards
                    unitsGrid.innerHTML = this.filteredUnits.map((unit) => this.createUnitCard(unit)).join("");

                    // Show results
                    resultsContainer.classList.remove("hidden");
                }

                createUnitCard(unit) {
                    const capacidad = this.getUnitCapacity(unit);
                    const volumen = this.getRecommendedVolume(unit);
                    const datos = unit.Datos || {};
                    const voltaje = datos.Voltaje || {};
                    const voltajeDC = voltaje.DC || [];
                    const voltajeStr = voltajeDC.length > 0 ? voltajeDC.join(", ") : "N/A";
                    const imageUrl = `/static/img/unidades/${unit.Modelo}.png`;

                    return `
                        <div class="bg-white rounded-lg border border-slate-200 p-6 hover:shadow-lg transition-shadow">
                            <!-- Unit Image -->
                            <div class="mb-4 flex items-center justify-center h-48 bg-slate-50 rounded-lg overflow-hidden">
                                <img
                                    src="${imageUrl}"
                                    alt="${unit.Modelo}"
                                    class="w-full h-full object-contain"
                                    onerror="this.parentElement.innerHTML='<div class=\\'text-slate-400 text-center\\'>Sin imagen</div>'"
                                />
                            </div>

                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-semibold text-slate-800">${unit.Modelo}</h4>
                                    <p class="text-sm text-slate-600 mt-1">${unit.Titulo}</p>
                                </div>
                                <span class="inline-flex items-center rounded-full bg-brand-100 px-2.5 py-0.5 text-xs font-medium text-brand-800">
                                    ${capacidad}W
                                </span>
                            </div>

                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">Capacidad de refrigeración:</span>
                                    <span class="font-medium">${capacidad}W</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">Voltaje:</span>
                                    <span class="font-medium">${voltajeStr}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">Volumen recomendado:</span>
                                    <span class="font-medium">${volumen}m³</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">Rango de temperatura:</span>
                                    <span class="font-medium">${datos["Rango de temperatura"]?.min || "N/A"}°C a ${datos["Rango de temperatura"]?.max || "N/A"}°C</span>
                                </div>
                            </div>

                            <div class="mt-4 pt-4 border-t border-slate-100">
                                <button onclick="catalogFilter.openModal('${unit.Modelo}')" class="w-full rounded-lg bg-brand-600 px-4 py-2 text-white font-medium hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-500">
                                    Ver detalles
                                </button>
                            </div>
                        </div>
                    `;
                }

                async clearFilters() {
                    document.getElementById("unitType").value = "";
                    document.getElementById("mountType").value = "";
                    document.getElementById("powerType").value = "";
                    document.getElementById("material").value = "";
                    document.getElementById("minCapacity").value = "";
                    document.getElementById("maxCapacity").value = "";

                    // Reset search state and hide all results when clearing filters
                    this.hasSearched = false;
                    this.filteredUnits = [];
                    this.displayResults();
                }

                async showAllUnits() {
                    await this.loadFilteredUnits({});
                    this.displayResults();
                }

                showError(message) {
                    const resultsContainer = document.getElementById("resultsContainer");
                    const noResults = document.getElementById("noResults");

                    resultsContainer.classList.add("hidden");
                    noResults.classList.remove("hidden");
                    noResults.querySelector("h3").textContent = "Error";
                    noResults.querySelector("p").textContent = message;
                }

                openModal(modelo) {
                    const unit = this.filteredUnits.find((u) => u.Modelo === modelo);
                    if (!unit) return;

                    const modal = document.getElementById("unitModal");
                    const modalTitle = document.getElementById("modalTitle");
                    const modalSubtitle = document.getElementById("modalSubtitle");
                    const modalContent = document.getElementById("modalContent");

                    modalTitle.textContent = unit.Modelo;
                    modalSubtitle.textContent = unit.Titulo;
                    modalContent.innerHTML = this.createDetailedContent(unit);

                    modal.classList.remove("hidden");
                    document.body.style.overflow = "hidden";
                }

                closeModal() {
                    const modal = document.getElementById("unitModal");
                    modal.classList.add("hidden");
                    document.body.style.overflow = "auto";
                }

                createDetailedContent(unit) {
                    const datos = unit.Datos || {};

                    let content = `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">`;

                    // Render all fields dynamically
                    Object.keys(datos).forEach((key) => {
                        const value = datos[key];

                        if (value === null || value === undefined || value === "") return;

                        content += `
                            <div class="bg-slate-50 rounded-lg p-4">
                                <h4 class="font-semibold text-slate-800 mb-3">${key}</h4>
                                <div class="space-y-2 text-sm">
                        `;

                        if (typeof value === "object" && !Array.isArray(value)) {
                            // Handle nested objects
                            Object.entries(value).forEach(([subKey, subValue]) => {
                                if (subValue !== null && subValue !== undefined && subValue !== "") {
                                    const formattedValue = this.formatValue(subValue);
                                    content += `
                                        <div class="flex justify-between">
                                            <span class="text-slate-600">${subKey}:</span>
                                            <span class="font-medium">${formattedValue}</span>
                                        </div>
                                    `;
                                }
                            });
                        } else {
                            // Handle primitive values
                            const formattedValue = this.formatValue(value);
                            content += `
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Valor:</span>
                                    <span class="font-medium">${formattedValue}</span>
                                </div>
                            `;
                        }

                        content += `</div></div>`;
                    });

                    content += `</div>`;

                    return content;
                }

                formatValue(value) {
                    if (Array.isArray(value)) {
                        return value.join(", ");
                    }
                    if (typeof value === "object" && value.min !== undefined && value.max !== undefined) {
                        // Handle new format with units in min/max values
                        if (typeof value.min === "string" && typeof value.max === "string") {
                            return `${value.min} - ${value.max}`;
                        }
                        // Handle old format with separate unidad field
                        return `${value.min} - ${value.max} ${value.unidad || ""}`.trim();
                    }
                    if (typeof value === "object" && value !== null) {
                        // Format plain objects as key-value pairs
                        return Object.entries(value)
                            .map(([k, v]) => `${k}: ${v}`)
                            .join(", ");
                    }
                    return value;
                }
            }

            // Initialize the catalog filter when the page loads
            let catalogFilter;
            document.addEventListener("DOMContentLoaded", () => {
                catalogFilter = new CatalogFilter();
            });
        </script>

        <!-- Safe-area bottom spacer -->
        <div style="height: env(safe-area-inset-bottom)"></div>
    </body>
</html>
